<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-7674654031652018",
enable_page_level_ads: true
});
</script><script>(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https'){
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else{
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script><title> spring data redis(一 对象序列化存入redis) · 由来</title><meta name="description" content="spring data redis(一 对象序列化存入redis) - kunpengku"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.youletter.cn/atom.xml" title="由来"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">由来</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于我</p></a><ul class="shortcut-icons"><a href="https://github.com/kunpengku" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">spring data redis(一 对象序列化存入redis)</h1><div class="post-info">2017年11月30日</div><div class="post-content"><p>spring data redis 是Spring对Redis支持的解决方案。<br>对于Spring boot 只要增加下面这个 依赖即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>这个包 整合了jedis 和 Spring-data-redis 两个主要的包。</p>
<h1 id="一些概念"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h1><h2 id="连接Redis"><a href="#连接Redis" class="headerlink" title="连接Redis"></a>连接Redis</h2><p>使用redis首先要连接redis， RedisConnection 和 RedisConnectionFactory 是两个主要的接口。</p>
<h1 id="RedisConnection"><a href="#RedisConnection" class="headerlink" title="RedisConnection"></a>RedisConnection</h1><p>RedisConnection为Redis通信提供构建块，因为它处理与Redis后端的通信。<br>RedisConnection提供了底层的方法，可以与redis通信，这些方法的 输入和返回都是二进制的值，即 byte [],  直接使用RedisConnection的话，需要 在调用方法时，自己处理 序列化和反序列化的问题。 比如 get()是， 需要把 String类型的key先 转成byte[] 的。</p>
<h1 id="RedisTemplate"><a href="#RedisTemplate" class="headerlink" title="RedisTemplate"></a>RedisTemplate</h1><p>与此对应，RedisTemplate提供比较 high-level的，更抽象的方法。比如 RedisTemplate可以在配置中，指定 key 和 value的 序列化方法 ，这样在 应用的地方， 就不用考虑 序列化的问题了。 后面会有具体的例子，来比较两者的区别。</p>
<h1 id="RedisConnectionFactory"><a href="#RedisConnectionFactory" class="headerlink" title="RedisConnectionFactory"></a>RedisConnectionFactory</h1><p>RedisConnection 是用 RedisConnectionFactory来创建的。<br>RedisConnectionFactory也是一个 抽象的接口 ，在1.7以前，支持4种流行的 开源redis java客户端。 1.7以后，支持两种 ，即JedisConnectionFactory 和 LettuceConnectionFactory。 默认是JedisConnectionFactory。</p>
<p><a href="https://docs.spring.io/spring-data/redis/docs/current/reference/html/#redis:connectors:jedis" target="_blank" rel="noopener">Configuring Jedis connector</a></p>
<p>在Spring boot中，只要有spring-boot-starter-data-redis 这个依赖， 启动程序后，会自用生成RedisConnectionFactory, StringRedisTemplate , RedisTemplate 这三个类的示例，直接可以Autoware。</p>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-connecting-to-redis" target="_blank" rel="noopener">Sprint boot Connecting to Redis</a><br>但如果想要控制更多信息，还是需要自己写Config文件，来自己示例化他们。</p>
<p>本文例子所使用的 工程，已经放在github上 <a href="https://github.com/kunpengku/spring-redis-example" target="_blank" rel="noopener">https://github.com/kunpengku/spring-redis-example</a></p>
<a id="more"></a>
<h1 id="示例准备"><a href="#示例准备" class="headerlink" title="示例准备"></a>示例准备</h1><ul>
<li>本机运行一个redis， localhost:6379</li>
<li>pom.xml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;groupId&gt;com.kunpengku&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;redis01&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">	&lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;name&gt;redis01&lt;/name&gt;</span><br><span class="line">	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;1.5.9.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">	&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">		&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">		&lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">			&lt;/plugin&gt;</span><br><span class="line">		&lt;/plugins&gt;</span><br><span class="line">	&lt;/build&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h1 id="示例1，-key是String，value是String，使用RedisConnection，-从redis获取value"><a href="#示例1，-key是String，value是String，使用RedisConnection，-从redis获取value" class="headerlink" title="示例1， key是String，value是String，使用RedisConnection， 从redis获取value"></a>示例1， key是String，value是String，使用RedisConnection， 从redis获取value</h1><p>spring boot会自动示例化RedisConnectionFactory， 但不会自动示例化RedisConnection， 所以需要写一个配置类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    RedisConnectionFactory redisConnectionFactory;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;conn&quot;)</span><br><span class="line">    RedisConnection getConn()&#123;</span><br><span class="line">        return redisConnectionFactory.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而且，给这个Bean起了一个名字 conn。</p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-chinesecoding/index.html" target="_blank" rel="noopener">深入分析 Java 中的中文编码问题</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;conn&quot;)</span><br><span class="line">RedisConnection connection;</span><br><span class="line"></span><br><span class="line">// key String ，value String ， get</span><br><span class="line">@RequestMapping(&quot;/test1&quot;)</span><br><span class="line">public void test1() throws UnsupportedEncodingException &#123;</span><br><span class="line">    String s = &quot;name&quot;;</span><br><span class="line">    byte[] ret = connection.get(s.getBytes(&quot;UTF8&quot;));</span><br><span class="line">    String s2 = new String(ret);</span><br><span class="line">    System.out.println(s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的是 RedisConnection的get方法。 这个方法的 输入和 输出都是 byte[]<br>这就是说它比较底层的原因。</p>
<p>先用命令行 去 给 “name” 这个key 设置一个东西 ，试一下能不能取出。 很简单。</p>
<h1 id="示例2-key是String，value是String，使用RedisConnection，-向redis-存入-value"><a href="#示例2-key是String，value是String，使用RedisConnection，-向redis-存入-value" class="headerlink" title="示例2 key是String，value是String，使用RedisConnection， 向redis 存入 value"></a>示例2 key是String，value是String，使用RedisConnection， 向redis 存入 value</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// key String and  value String   \ set</span><br><span class="line">@RequestMapping(&quot;/test2&quot;)</span><br><span class="line">public String test2() throws UnsupportedEncodingException &#123;</span><br><span class="line">    String key = &quot;name2&quot;;</span><br><span class="line">    String value = &quot;fupeng&quot;;</span><br><span class="line">    connection.set(key.getBytes(&quot;UTF8&quot;), value.getBytes(&quot;UTF8&quot;));</span><br><span class="line"></span><br><span class="line">    byte[] ret = connection.get(key.getBytes(&quot;UTF8&quot;));</span><br><span class="line">    String s3 = new String(ret);</span><br><span class="line">    System.out.println(s3);</span><br><span class="line"></span><br><span class="line">    return s3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二个例子用的是 RedisConnection 的 set方法， 传入两个参数，同样都是 byte[]</p>
<h1 id="示例3-key是String，value是Object，使用RedisConnection，-向redis-存入-Java对象"><a href="#示例3-key是String，value是Object，使用RedisConnection，-向redis-存入-Java对象" class="headerlink" title="示例3 key是String，value是Object，使用RedisConnection， 向redis 存入 Java对象"></a>示例3 key是String，value是Object，使用RedisConnection， 向redis 存入 Java对象</h1><p>对于POJO对象，可以将对象 序列化成json string，然后再反序列化成对象。 但是对于 复杂的对象，或者一些 没有setter/getter的 ，别人的对象，这时json序列化之后，将来没办法 反序列化 成一个对象。 对于这种场景，就需要 直接 向redis存入 对象 java序列化后的 字节。 以便未来能重建成对象。</p>
<p>需要序列化的对象，必须实现 Serializable 接口。<br>例子中 我要向redis存的是Apple对象, Apple有一个属性是 Mac对象。<br>Apple.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Apple implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1;</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    int age;</span><br><span class="line">    Mac mac;</span><br><span class="line"></span><br><span class="line">    public Apple(String name, int age, Mac mac) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">        this.mac = mac;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Apple&#123;&quot; + &quot;name=&apos;&quot; + name + &apos;\&apos;&apos; + &quot;, age=&quot; + age + &quot;, mac=&quot; + mac + &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Mac.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Mac implements Serializable&#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1;</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    int age;</span><br><span class="line"></span><br><span class="line">    public Mac(String name, int age) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用RedisConnection 存入Java对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// key String and value Object   | set</span><br><span class="line">@RequestMapping(&quot;/test3&quot;)</span><br><span class="line">public void test3() throws UnsupportedEncodingException &#123;</span><br><span class="line">    String key = &quot;name3&quot;;</span><br><span class="line">    Mac mac = new Mac(&quot;mac&quot;, 12);</span><br><span class="line">    Apple apple = new Apple(&quot;mac&quot;, 90, mac);</span><br><span class="line"></span><br><span class="line">    JdkSerializationRedisSerializer serializer = new JdkSerializationRedisSerializer();</span><br><span class="line"></span><br><span class="line">    byte[] apple_byte = serializer.serialize(apple);</span><br><span class="line">    connection.set(key.getBytes(&quot;UTF8&quot;), apple_byte);</span><br><span class="line"></span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要存入java对象，需要对 对象进行序列化，有多重序列化的函数</p>
<ul>
<li>StringRedisSerializer</li>
<li>JdkSerializationRedisSerializer</li>
<li>Jackson2JsonRedisSerializer</li>
</ul>
<p><a href="https://docs.spring.io/spring-data/redis/docs/current/reference/html/#redis:serializer" target="_blank" rel="noopener">官方文档介绍 Serializers</a></p>
<p>例子中采用JdkSerializationRedisSerializer 来对 Apple进行序列化。</p>
<p>调用方法之后，可以从 redis-cli中查看这个值, 是字节，而非字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get name3</span><br><span class="line">&quot;\xac\xed\x00\x05sr\x00\&quot;com.kunpengku.redis01.domain.Apple\x00\x00\x00\x00\x00\x00\x00\x01\x02\x00\x03I\x00\x03ageL\x00\x03mact\x00\&quot;Lcom/kunpengku/redis01/domain/Mac;L\x00\x04namet\x00\x12Ljava/lang/String;xp\x00\x00\x00Zsr\x00 com.kunpengku.redis01.domain.Mac\x00\x00\x00\x00\x00\x00\x00\x01\x02\x00\x02I\x00\x03ageL\x00\x04nameq\x00~\x00\x02xp\x00\x00\x00\x0ct\x00\x03macq\x00~\x00\x06&quot;</span><br></pre></td></tr></table></figure>
<h1 id="示例4-key是String，value是Object，使用RedisConnection，-从redis-读出-Java对象"><a href="#示例4-key是String，value是Object，使用RedisConnection，-从redis-读出-Java对象" class="headerlink" title="示例4 key是String，value是Object，使用RedisConnection， 从redis 读出 Java对象"></a>示例4 key是String，value是Object，使用RedisConnection， 从redis 读出 Java对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// key String and  value Object   | get</span><br><span class="line">@RequestMapping(&quot;/test4&quot;)</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    String key = &quot;name3&quot;;</span><br><span class="line">    JdkSerializationRedisSerializer serializer = new JdkSerializationRedisSerializer();</span><br><span class="line"></span><br><span class="line">    byte[] apple_byte = connection.get(key.getBytes());</span><br><span class="line"></span><br><span class="line">    Apple apple = (Apple) serializer.deserialize(apple_byte);</span><br><span class="line"></span><br><span class="line">    System.out.println(apple);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过debug 可以看到，apple 已经 反序列化成功。</p>
<p>示例1-4 使用的是RedisConnection直接与redis交流。RedisConnection被认为是比较底层的接口。因为每次都要处理序列化的问题。</p>
<p>框架还提供了RedisTemplate，这是比较抽象，high-level的接口。</p>
<h1 id="示例5-同示例1-key是String，value是String，使用RedisTemplate，-从redis获取value"><a href="#示例5-同示例1-key是String，value是String，使用RedisTemplate，-从redis获取value" class="headerlink" title="示例5 同示例1 key是String，value是String，使用RedisTemplate， 从redis获取value"></a>示例5 同示例1 key是String，value是String，使用RedisTemplate， 从redis获取value</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line">// StringRedisTemplate 这个是 自动 示例化的，对于key和value都是 string 的情况，可以直接用.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// key String and  value String \ get</span><br><span class="line">@RequestMapping(&quot;/test1&quot;)</span><br><span class="line">public String test1()&#123;</span><br><span class="line">    String key = &quot;name1&quot;;</span><br><span class="line">    String ret  =  stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用的是StringRedisTemplate， 它是RedisTemplate的一个子类，定制化的，针对于 key和value都是String的情况。 这个类在Spring boot中会自动示例化，所以直接 注入即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public StringRedisTemplate() &#123;</span><br><span class="line">	RedisSerializer&lt;String&gt; stringSerializer = new StringRedisSerializer();</span><br><span class="line">	setKeySerializer(stringSerializer);</span><br><span class="line">	setValueSerializer(stringSerializer);</span><br><span class="line">	setHashKeySerializer(stringSerializer);</span><br><span class="line">	setHashValueSerializer(stringSerializer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从这个类的构造函数可以看出 ，他里面的key，value等都用了 同样的序列化方法 ：StringRedisSerializer，这是针对String的序列化方法，使用UTF8编码。</p>
<h1 id="示例6-同示例2-，用RedisTemplate实现，key是String，value是String，-将字符串存入redis"><a href="#示例6-同示例2-，用RedisTemplate实现，key是String，value是String，-将字符串存入redis" class="headerlink" title="示例6 同示例2 ，用RedisTemplate实现，key是String，value是String， 将字符串存入redis"></a>示例6 同示例2 ，用RedisTemplate实现，key是String，value是String， 将字符串存入redis</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// key String and  value String \ set</span><br><span class="line">@RequestMapping(&quot;/test2&quot;)</span><br><span class="line">public void test2()&#123;</span><br><span class="line">    String key = &quot;name2&quot;;</span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, &quot;fupeng&quot;);</span><br><span class="line"></span><br><span class="line">    String ret  =  stringRedisTemplate.opsForValue().get(&quot;name2&quot;);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="示例7-同示例3，用RedisTemplate实现，-key是String，value是对象。-将对象存入-redis"><a href="#示例7-同示例3，用RedisTemplate实现，-key是String，value是对象。-将对象存入-redis" class="headerlink" title="示例7 同示例3，用RedisTemplate实现， key是String，value是对象。 将对象存入 redis"></a>示例7 同示例3，用RedisTemplate实现， key是String，value是对象。 将对象存入 redis</h1><p>这是需要在配置文件中，生成一个RedisTemplate&lt;String, Object&gt; 的bean，<br>关键是设置 key和value的 序列化方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Bean(&quot;forObject&quot;)</span><br><span class="line">RedisTemplate createRedisTemplate(RedisConnectionFactory factory</span><br><span class="line">        ) &#123;</span><br><span class="line">    RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();</span><br><span class="line">    JdkSerializationRedisSerializer redisSerializer = new JdkSerializationRedisSerializer();</span><br><span class="line">    RedisSerializer&lt;String&gt; stringSerializer = new StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">    template.setConnectionFactory(factory);</span><br><span class="line">    template.setKeySerializer(stringSerializer);</span><br><span class="line">    template.setValueSerializer(redisSerializer);</span><br><span class="line">    return template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>存入Java对象，这时候set方法 直接传对象即可，不用再这里序列化。（其实是把这个设置给 统一做了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;forObject&quot;)</span><br><span class="line">RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">// key String and  value Object  \ set</span><br><span class="line">@RequestMapping(&quot;/test3&quot;)</span><br><span class="line">public void test3()&#123;</span><br><span class="line">    String key = &quot;name3&quot;;</span><br><span class="line">    Mac mac = new Mac(&quot;mac&quot;,12);</span><br><span class="line">    Apple apple = new Apple(&quot;mac&quot;, 90, mac);</span><br><span class="line"></span><br><span class="line">    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate</span><br><span class="line">            .opsForValue();</span><br><span class="line">    valueOperations.set(key, apple);</span><br><span class="line"></span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="示例8-同示例4，用RedisTemplate实现，-key是String，value是对象。-从redis中取回对象"><a href="#示例8-同示例4，用RedisTemplate实现，-key是String，value是对象。-从redis中取回对象" class="headerlink" title="示例8 同示例4，用RedisTemplate实现， key是String，value是对象。 从redis中取回对象"></a>示例8 同示例4，用RedisTemplate实现， key是String，value是对象。 从redis中取回对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// key String and  value Object  \ get</span><br><span class="line">@RequestMapping(&quot;/test4&quot;)</span><br><span class="line">public void test4()&#123;</span><br><span class="line">    String key = &quot;name3&quot;;</span><br><span class="line"></span><br><span class="line">    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate</span><br><span class="line">            .opsForValue();</span><br><span class="line">    Apple apple = (Apple) valueOperations.get(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(apple);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果想用RedisTemplate ，依然返回byte [] ，怎么设置呢？</p>
<h1 id="示例-9-使用RedisTemplate，value是对象，返回byte-向redis存入对象"><a href="#示例-9-使用RedisTemplate，value是对象，返回byte-向redis存入对象" class="headerlink" title="示例 9  使用RedisTemplate，value是对象，返回byte[], 向redis存入对象"></a>示例 9  使用RedisTemplate，value是对象，返回byte[], 向redis存入对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Bean(&quot;forObject_byte&quot;)</span><br><span class="line">RedisTemplate createRedisTemplate2(RedisConnectionFactory factory</span><br><span class="line">) &#123;</span><br><span class="line">    RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();</span><br><span class="line">    JdkSerializationRedisSerializer redisSerializer = new JdkSerializationRedisSerializer();</span><br><span class="line">    RedisSerializer&lt;String&gt; stringSerializer = new StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">    template.setConnectionFactory(factory);</span><br><span class="line">    template.setKeySerializer(stringSerializer);</span><br><span class="line">    template.setEnableDefaultSerializer(false);</span><br><span class="line">    return template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先需要 重新建 一个RedisTemplate&lt;String, Object&gt;， 为了让返回 byte[]， 需要<br>设置 <code>template.setEnableDefaultSerializer(false);</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;forObject_byte&quot;)</span><br><span class="line">RedisTemplate redisTemplate_byte;</span><br><span class="line"></span><br><span class="line">// key String and  value Object  \ get</span><br><span class="line">@RequestMapping(&quot;/test5&quot;)</span><br><span class="line">public void test5()&#123;</span><br><span class="line">    String key = &quot;name4&quot;;</span><br><span class="line"></span><br><span class="line">    Mac mac = new Mac(&quot;mac&quot;,88);</span><br><span class="line">    Apple apple = new Apple(&quot;mac&quot;, 66, mac);</span><br><span class="line"></span><br><span class="line">    JdkSerializationRedisSerializer redisSerializer =</span><br><span class="line">            new JdkSerializationRedisSerializer();</span><br><span class="line"></span><br><span class="line">    byte [] data = redisSerializer.serialize(apple);</span><br><span class="line"></span><br><span class="line">    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate_byte</span><br><span class="line">            .opsForValue();</span><br><span class="line"></span><br><span class="line">    valueOperations.set(key, data);</span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="示例-10-使用RedisTemplate，value是对象，返回byte-从redis取回对象"><a href="#示例-10-使用RedisTemplate，value是对象，返回byte-从redis取回对象" class="headerlink" title="示例 10  使用RedisTemplate，value是对象，返回byte[], 从redis取回对象"></a>示例 10  使用RedisTemplate，value是对象，返回byte[], 从redis取回对象</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// key String and  value Object  \ get</span><br><span class="line">@RequestMapping(&quot;/test6&quot;)</span><br><span class="line">public void test6()&#123;</span><br><span class="line">    String key = &quot;name4&quot;;</span><br><span class="line"></span><br><span class="line">    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate_byte</span><br><span class="line">            .opsForValue();</span><br><span class="line"></span><br><span class="line">    Object o = valueOperations.get(key);</span><br><span class="line">    byte [] apple_byte = (byte[]) o;</span><br><span class="line"></span><br><span class="line">    JdkSerializationRedisSerializer redisSerializer =</span><br><span class="line">            new JdkSerializationRedisSerializer();</span><br><span class="line"></span><br><span class="line">    Apple apple = (Apple) redisSerializer.deserialize(apple_byte);</span><br><span class="line"></span><br><span class="line">    System.out.println(apple);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么会有 RedisTemplate 还需要返回 byte[] 这样奇怪的需求呢？ 想想吧。</p>
<p>可能要混用RedisTemplate和 RedisConnection。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>redis中存的是 byte[]<br>java中使用的是对象<br>当二者要沟通的时候， 一定会有序列化。</p>
</div></article></div><div id="disqus_thread"></div></div><div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;"><img src="/images/WechatIMG5.jpeg" width="180px"><p>简单点，讨钱的方式简单点</p><button style="display: inline-block;      width: 80px;      height: 35px;      border-radius: 5px;      color: #fff;      font-weight: 400;      font-style: normal;      font-variant: normal;      font-stretch: normal;      font-size: 18px;      background: #f44336;"><span>赏</span></button></div><div id="ads"></div><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 底部01--><ins style="display:block" data-ad-client="ca-pub-7674654031652018" data-ad-slot="3127803056" data-ad-format="auto" class="adsbygoogle"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});

</script><div id="SOHUCS"></div><script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js"></script><script type="text/javascript">window.changyan.api.config({
appid: 'cytkri3BC',
conf: 'prod_1e787a373da7a5fa9ef7156a6dae5e6b'
});
</script></main><footer class="footer-container"><div class="paginator"><a href="/2017/12/01/jenkins-一-安装/" class="prev">上一篇</a><a href="/2017/11/30/Spring-boot参考（一）/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="mailto:fupeng_2005@126.com">kunpengku</a>, <a href="http://www.miitbeian.gov.cn">京ICP备17058936号-1</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"angrypowman",'auto');ga('send','pageview');</script></body></html>