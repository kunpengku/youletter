<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-7674654031652018",
enable_page_level_ads: true
});
</script><script>(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https'){
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else{
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script><title> spring security-preface · 由来</title><meta name="description" content="spring security-preface - kunpengku"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.youletter.cn/atom.xml" title="由来"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">由来</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于我</p></a><ul class="shortcut-icons"><a href="https://github.com/kunpengku" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">spring security-preface</h1><div class="post-info">2017年12月11日</div><div class="post-content"><p>官方文档</p>
<p><a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle" target="_blank" rel="noopener">Spring Security Reference</a></p>
<p><a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project" target="_blank" rel="noopener">十大漏洞</a></p>
<p>Authentication 是 识别建立一个 Principal ,Principal是一个用户，或者一个人，或者一个设备，就是行为主体， 认证之意，证明你是你。</p>
<p>Authorization 是决定 这个Principal   能有哪些行为。 授权之意，表示你能做什么。</p>
<h2 id="Spring-Security-版本号说明"><a href="#Spring-Security-版本号说明" class="headerlink" title="Spring Security 版本号说明"></a>Spring Security 版本号说明</h2><p>版本号分三级 MAJOR.MINOR.PATCH</p>
<p>MAJOR 的意思是 API有重大修改，不兼容。  如 5.0.0 和 4.2.3 不兼容。</p>
<p>MINOR 的意思是 小的修改 ，可能不兼容。</p>
<p>PATCH 绝对兼容。比如 4.2.3 和 4.2.1</p>
<h2 id="maven-依赖"><a href="#maven-依赖" class="headerlink" title="maven 依赖"></a>maven 依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;5.0.0.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;5.0.0.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>实际的开发中 可能不会 显示的 写这个依赖 ，比如 如果用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>就会包含这个依赖。</p>
<h2 id="开启debug日志"><a href="#开启debug日志" class="headerlink" title="开启debug日志"></a>开启debug日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 开启spring security的 debug日志</span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    org:</span><br><span class="line">      springframework:</span><br><span class="line">        security: DEBUG</span><br></pre></td></tr></table></figure>
<h2 id="SecurityContextHolder"><a href="#SecurityContextHolder" class="headerlink" title="SecurityContextHolder"></a>SecurityContextHolder</h2><p>This is where we store details of the present security context</p>
<h2 id="Authentication中存储-个人信息。"><a href="#Authentication中存储-个人信息。" class="headerlink" title="Authentication中存储 个人信息。"></a>Authentication中存储 个人信息。</h2><p>Authentication中存储 个人信息<br>在程序中的任何地方，可以用下面这段代码 来获取 已 认证的 用户信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line"></span><br><span class="line">if (principal instanceof UserDetails) &#123;</span><br><span class="line">String username = ((UserDetails)principal).getUsername();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">String username = principal.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="UserDetails"><a href="#UserDetails" class="headerlink" title="UserDetails"></a>UserDetails</h2><p>Authentication 中可以取到 Principal ，这是一个Object ，在Spring Security中Principal 大部分情况都是 UserDetails。</p>
<p>UserDetails是一个核心接口，它是 SecurityContextHolder 和 你的数据库中 真是用户信息的 一种联系。</p>
<h2 id="UserDetailsService"><a href="#UserDetailsService" class="headerlink" title="UserDetailsService"></a>UserDetailsService</h2><p>获取UserDetails的方法是  实现UserDetailsService 接口， 这个接口 只有一个方法， 就是通过 String name 获取 UserDetails。</p>
<p>对于UserDetailsService的实现，官方有一个基于数据库的实现 JdbcDaoImpl ，很有参考的地方。</p>
<a id="more"></a>
<p>JdbcDaoImpl.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Copyright 2004, 2005, 2006 Acegi Technology Pty Limited</span><br><span class="line"> *</span><br><span class="line"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"> * you may not use this file except in compliance with the License.</span><br><span class="line"> * You may obtain a copy of the License at</span><br><span class="line"> *</span><br><span class="line"> *      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"> * See the License for the specific language governing permissions and</span><br><span class="line"> * limitations under the License.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">package org.springframework.security.core.userdetails.jdbc;</span><br><span class="line"></span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.ApplicationContextException;</span><br><span class="line">import org.springframework.context.MessageSource;</span><br><span class="line">import org.springframework.context.MessageSourceAware;</span><br><span class="line">import org.springframework.context.support.MessageSourceAccessor;</span><br><span class="line">import org.springframework.jdbc.core.RowMapper;</span><br><span class="line">import org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line">import org.springframework.security.core.GrantedAuthority;</span><br><span class="line">import org.springframework.security.core.SpringSecurityMessageSource;</span><br><span class="line">import org.springframework.security.core.authority.AuthorityUtils;</span><br><span class="line">import org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line">import org.springframework.security.core.userdetails.User;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line">import org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;tt&gt;UserDetailsServiceRetrieves&lt;/tt&gt; implementation which retrieves the user details</span><br><span class="line"> * (username, password, enabled flag, and authorities) from a database using JDBC queries.</span><br><span class="line"> *</span><br><span class="line"> * &lt;h3&gt;Default Schema&lt;/h3&gt; A default database schema is assumed, with two tables &quot;users&quot;</span><br><span class="line"> * and &quot;authorities&quot;.</span><br><span class="line"> *</span><br><span class="line"> * &lt;h4&gt;The Users table&lt;/h4&gt;</span><br><span class="line"> *</span><br><span class="line"> * This table contains the login name, password and enabled status of the user.</span><br><span class="line"> *</span><br><span class="line"> * &lt;table summary=&quot;The Users Table&quot;&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;th&gt;Column&lt;/th&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;td&gt;username&lt;/td&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;td&gt;password&lt;/td&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;td&gt;enabled&lt;/td&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;/table&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;h4&gt;The Authorities Table&lt;/h4&gt;</span><br><span class="line"> *</span><br><span class="line"> * &lt;table summary=&quot;The Authorities Table&quot;&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;th&gt;Column&lt;/th&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;td&gt;username&lt;/td&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;tr&gt;</span><br><span class="line"> * &lt;td&gt;authority&lt;/td&gt;</span><br><span class="line"> * &lt;/tr&gt;</span><br><span class="line"> * &lt;/table&gt;</span><br><span class="line"> *</span><br><span class="line"> * If you are using an existing schema you will have to set the queries</span><br><span class="line"> * &lt;tt&gt;usersByUsernameQuery&lt;/tt&gt; and &lt;tt&gt;authoritiesByUsernameQuery&lt;/tt&gt; to match your</span><br><span class="line"> * database setup (see &#123;@link #DEF_USERS_BY_USERNAME_QUERY&#125; and</span><br><span class="line"> * &#123;@link #DEF_AUTHORITIES_BY_USERNAME_QUERY&#125;).</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * In order to minimise backward compatibility issues, this implementation doesn&apos;t</span><br><span class="line"> * recognise the expiration of user accounts or the expiration of user credentials.</span><br><span class="line"> * However, it does recognise and honour the user enabled/disabled column. This should map</span><br><span class="line"> * to a &lt;tt&gt;boolean&lt;/tt&gt; type in the result set (the SQL type will depend on the database</span><br><span class="line"> * you are using). All the other columns map to &lt;tt&gt;String&lt;/tt&gt;s.</span><br><span class="line"> *</span><br><span class="line"> * &lt;h3&gt;Group Support&lt;/h3&gt; Support for group-based authorities can be enabled by setting</span><br><span class="line"> * the &lt;tt&gt;enableGroups&lt;/tt&gt; property to &lt;tt&gt;true&lt;/tt&gt; (you may also then wish to set</span><br><span class="line"> * &lt;tt&gt;enableAuthorities&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt; to disable loading of authorities</span><br><span class="line"> * directly). With this approach, authorities are allocated to groups and a user&apos;s</span><br><span class="line"> * authorities are determined based on the groups they are a member of. The net result is</span><br><span class="line"> * the same (a UserDetails containing a set of &lt;tt&gt;GrantedAuthority&lt;/tt&gt;s is loaded), but</span><br><span class="line"> * the different persistence strategy may be more suitable for the administration of some</span><br><span class="line"> * applications.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * When groups are being used, the tables &quot;groups&quot;, &quot;group_members&quot; and</span><br><span class="line"> * &quot;group_authorities&quot; are used. See &#123;@link #DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY&#125; for</span><br><span class="line"> * the default query which is used to load the group authorities. Again you can customize</span><br><span class="line"> * this by setting the &lt;tt&gt;groupAuthoritiesByUsernameQuery&lt;/tt&gt; property, but the format</span><br><span class="line"> * of the rows returned should match the default.</span><br><span class="line"> *</span><br><span class="line"> * @author Ben Alex</span><br><span class="line"> * @author colin sampaleanu</span><br><span class="line"> * @author Luke Taylor</span><br><span class="line"> */</span><br><span class="line">public class JdbcDaoImpl extends JdbcDaoSupport</span><br><span class="line">		implements UserDetailsService, MessageSourceAware &#123;</span><br><span class="line">	// ~ Static fields/initializers</span><br><span class="line">	// =====================================================================================</span><br><span class="line"></span><br><span class="line">	public static final String DEF_USERS_BY_USERNAME_QUERY = &quot;select username,password,enabled &quot;</span><br><span class="line">			+ &quot;from users &quot; + &quot;where username = ?&quot;;</span><br><span class="line">	public static final String DEF_AUTHORITIES_BY_USERNAME_QUERY = &quot;select username,authority &quot;</span><br><span class="line">			+ &quot;from authorities &quot; + &quot;where username = ?&quot;;</span><br><span class="line">	public static final String DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY = &quot;select g.id, g.group_name, ga.authority &quot;</span><br><span class="line">			+ &quot;from groups g, group_members gm, group_authorities ga &quot;</span><br><span class="line">			+ &quot;where gm.username = ? &quot; + &quot;and g.id = ga.group_id &quot;</span><br><span class="line">			+ &quot;and g.id = gm.group_id&quot;;</span><br><span class="line"></span><br><span class="line">	// ~ Instance fields</span><br><span class="line">	// ================================================================================================</span><br><span class="line"></span><br><span class="line">	protected MessageSourceAccessor messages = SpringSecurityMessageSource.getAccessor();</span><br><span class="line"></span><br><span class="line">	private String authoritiesByUsernameQuery;</span><br><span class="line">	private String groupAuthoritiesByUsernameQuery;</span><br><span class="line">	private String usersByUsernameQuery;</span><br><span class="line">	private String rolePrefix = &quot;&quot;;</span><br><span class="line">	private boolean usernameBasedPrimaryKey = true;</span><br><span class="line">	private boolean enableAuthorities = true;</span><br><span class="line">	private boolean enableGroups;</span><br><span class="line"></span><br><span class="line">	// ~ Constructors</span><br><span class="line">	// ===================================================================================================</span><br><span class="line"></span><br><span class="line">	public JdbcDaoImpl() &#123;</span><br><span class="line">		this.usersByUsernameQuery = DEF_USERS_BY_USERNAME_QUERY;</span><br><span class="line">		this.authoritiesByUsernameQuery = DEF_AUTHORITIES_BY_USERNAME_QUERY;</span><br><span class="line">		this.groupAuthoritiesByUsernameQuery = DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// ~ Methods</span><br><span class="line">	// ========================================================================================================</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * @return the messages</span><br><span class="line">	 */</span><br><span class="line">	protected MessageSourceAccessor getMessages() &#123;</span><br><span class="line">		return this.messages;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Allows subclasses to add their own granted authorities to the list to be returned</span><br><span class="line">	 * in the &lt;tt&gt;UserDetails&lt;/tt&gt;.</span><br><span class="line">	 *</span><br><span class="line">	 * @param username the username, for use by finder methods</span><br><span class="line">	 * @param authorities the current granted authorities, as populated from the</span><br><span class="line">	 * &lt;code&gt;authoritiesByUsername&lt;/code&gt; mapping</span><br><span class="line">	 */</span><br><span class="line">	protected void addCustomAuthorities(String username,</span><br><span class="line">			List&lt;GrantedAuthority&gt; authorities) &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getUsersByUsernameQuery() &#123;</span><br><span class="line">		return this.usersByUsernameQuery;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void initDao() throws ApplicationContextException &#123;</span><br><span class="line">		Assert.isTrue(this.enableAuthorities || this.enableGroups,</span><br><span class="line">				&quot;Use of either authorities or groups must be enabled&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public UserDetails loadUserByUsername(String username)</span><br><span class="line">			throws UsernameNotFoundException &#123;</span><br><span class="line">		List&lt;UserDetails&gt; users = loadUsersByUsername(username);</span><br><span class="line"></span><br><span class="line">		if (users.size() == 0) &#123;</span><br><span class="line">			this.logger.debug(&quot;Query returned no results for user &apos;&quot; + username + &quot;&apos;&quot;);</span><br><span class="line"></span><br><span class="line">			throw new UsernameNotFoundException(</span><br><span class="line">					this.messages.getMessage(&quot;JdbcDaoImpl.notFound&quot;,</span><br><span class="line">							new Object[] &#123; username &#125;, &quot;Username &#123;0&#125; not found&quot;));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		UserDetails user = users.get(0); // contains no GrantedAuthority[]</span><br><span class="line"></span><br><span class="line">		Set&lt;GrantedAuthority&gt; dbAuthsSet = new HashSet&lt;GrantedAuthority&gt;();</span><br><span class="line"></span><br><span class="line">		if (this.enableAuthorities) &#123;</span><br><span class="line">			dbAuthsSet.addAll(loadUserAuthorities(user.getUsername()));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (this.enableGroups) &#123;</span><br><span class="line">			dbAuthsSet.addAll(loadGroupAuthorities(user.getUsername()));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		List&lt;GrantedAuthority&gt; dbAuths = new ArrayList&lt;GrantedAuthority&gt;(dbAuthsSet);</span><br><span class="line"></span><br><span class="line">		addCustomAuthorities(user.getUsername(), dbAuths);</span><br><span class="line"></span><br><span class="line">		if (dbAuths.size() == 0) &#123;</span><br><span class="line">			this.logger.debug(&quot;User &apos;&quot; + username</span><br><span class="line">					+ &quot;&apos; has no authorities and will be treated as &apos;not found&apos;&quot;);</span><br><span class="line"></span><br><span class="line">			throw new UsernameNotFoundException(this.messages.getMessage(</span><br><span class="line">					&quot;JdbcDaoImpl.noAuthority&quot;, new Object[] &#123; username &#125;,</span><br><span class="line">					&quot;User &#123;0&#125; has no GrantedAuthority&quot;));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		return createUserDetails(username, user, dbAuths);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Executes the SQL &lt;tt&gt;usersByUsernameQuery&lt;/tt&gt; and returns a list of UserDetails</span><br><span class="line">	 * objects. There should normally only be one matching user.</span><br><span class="line">	 */</span><br><span class="line">	protected List&lt;UserDetails&gt; loadUsersByUsername(String username) &#123;</span><br><span class="line">		return getJdbcTemplate().query(this.usersByUsernameQuery,</span><br><span class="line">				new String[] &#123; username &#125;, new RowMapper&lt;UserDetails&gt;() &#123;</span><br><span class="line">					@Override</span><br><span class="line">					public UserDetails mapRow(ResultSet rs, int rowNum)</span><br><span class="line">							throws SQLException &#123;</span><br><span class="line">						String username = rs.getString(1);</span><br><span class="line">						String password = rs.getString(2);</span><br><span class="line">						boolean enabled = rs.getBoolean(3);</span><br><span class="line">						return new User(username, password, enabled, true, true, true,</span><br><span class="line">								AuthorityUtils.NO_AUTHORITIES);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Loads authorities by executing the SQL from &lt;tt&gt;authoritiesByUsernameQuery&lt;/tt&gt;.</span><br><span class="line">	 *</span><br><span class="line">	 * @return a list of GrantedAuthority objects for the user</span><br><span class="line">	 */</span><br><span class="line">	protected List&lt;GrantedAuthority&gt; loadUserAuthorities(String username) &#123;</span><br><span class="line">		return getJdbcTemplate().query(this.authoritiesByUsernameQuery,</span><br><span class="line">				new String[] &#123; username &#125;, new RowMapper&lt;GrantedAuthority&gt;() &#123;</span><br><span class="line">					@Override</span><br><span class="line">					public GrantedAuthority mapRow(ResultSet rs, int rowNum)</span><br><span class="line">							throws SQLException &#123;</span><br><span class="line">						String roleName = JdbcDaoImpl.this.rolePrefix + rs.getString(2);</span><br><span class="line"></span><br><span class="line">						return new SimpleGrantedAuthority(roleName);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Loads authorities by executing the SQL from</span><br><span class="line">	 * &lt;tt&gt;groupAuthoritiesByUsernameQuery&lt;/tt&gt;.</span><br><span class="line">	 *</span><br><span class="line">	 * @return a list of GrantedAuthority objects for the user</span><br><span class="line">	 */</span><br><span class="line">	protected List&lt;GrantedAuthority&gt; loadGroupAuthorities(String username) &#123;</span><br><span class="line">		return getJdbcTemplate().query(this.groupAuthoritiesByUsernameQuery,</span><br><span class="line">				new String[] &#123; username &#125;, new RowMapper&lt;GrantedAuthority&gt;() &#123;</span><br><span class="line">					@Override</span><br><span class="line">					public GrantedAuthority mapRow(ResultSet rs, int rowNum)</span><br><span class="line">							throws SQLException &#123;</span><br><span class="line">						String roleName = getRolePrefix() + rs.getString(3);</span><br><span class="line"></span><br><span class="line">						return new SimpleGrantedAuthority(roleName);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Can be overridden to customize the creation of the final UserDetailsObject which is</span><br><span class="line">	 * returned by the &lt;tt&gt;loadUserByUsername&lt;/tt&gt; method.</span><br><span class="line">	 *</span><br><span class="line">	 * @param username the name originally passed to loadUserByUsername</span><br><span class="line">	 * @param userFromUserQuery the object returned from the execution of the</span><br><span class="line">	 * @param combinedAuthorities the combined array of authorities from all the authority</span><br><span class="line">	 * loading queries.</span><br><span class="line">	 * @return the final UserDetails which should be used in the system.</span><br><span class="line">	 */</span><br><span class="line">	protected UserDetails createUserDetails(String username,</span><br><span class="line">			UserDetails userFromUserQuery, List&lt;GrantedAuthority&gt; combinedAuthorities) &#123;</span><br><span class="line">		String returnUsername = userFromUserQuery.getUsername();</span><br><span class="line"></span><br><span class="line">		if (!this.usernameBasedPrimaryKey) &#123;</span><br><span class="line">			returnUsername = username;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		return new User(returnUsername, userFromUserQuery.getPassword(),</span><br><span class="line">				userFromUserQuery.isEnabled(), true, true, true, combinedAuthorities);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Allows the default query string used to retrieve authorities based on username to</span><br><span class="line">	 * be overridden, if default table or column names need to be changed. The default</span><br><span class="line">	 * query is &#123;@link #DEF_AUTHORITIES_BY_USERNAME_QUERY&#125;; when modifying this query,</span><br><span class="line">	 * ensure that all returned columns are mapped back to the same column names as in the</span><br><span class="line">	 * default query.</span><br><span class="line">	 *</span><br><span class="line">	 * @param queryString The SQL query string to set</span><br><span class="line">	 */</span><br><span class="line">	public void setAuthoritiesByUsernameQuery(String queryString) &#123;</span><br><span class="line">		this.authoritiesByUsernameQuery = queryString;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected String getAuthoritiesByUsernameQuery() &#123;</span><br><span class="line">		return this.authoritiesByUsernameQuery;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Allows the default query string used to retrieve group authorities based on</span><br><span class="line">	 * username to be overridden, if default table or column names need to be changed. The</span><br><span class="line">	 * default query is &#123;@link #DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY&#125;; when modifying</span><br><span class="line">	 * this query, ensure that all returned columns are mapped back to the same column</span><br><span class="line">	 * names as in the default query.</span><br><span class="line">	 *</span><br><span class="line">	 * @param queryString The SQL query string to set</span><br><span class="line">	 */</span><br><span class="line">	public void setGroupAuthoritiesByUsernameQuery(String queryString) &#123;</span><br><span class="line">		this.groupAuthoritiesByUsernameQuery = queryString;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Allows a default role prefix to be specified. If this is set to a non-empty value,</span><br><span class="line">	 * then it is automatically prepended to any roles read in from the db. This may for</span><br><span class="line">	 * example be used to add the &lt;tt&gt;ROLE_&lt;/tt&gt; prefix expected to exist in role names</span><br><span class="line">	 * (by default) by some other Spring Security classes, in the case that the prefix is</span><br><span class="line">	 * not already present in the db.</span><br><span class="line">	 *</span><br><span class="line">	 * @param rolePrefix the new prefix</span><br><span class="line">	 */</span><br><span class="line">	public void setRolePrefix(String rolePrefix) &#123;</span><br><span class="line">		this.rolePrefix = rolePrefix;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected String getRolePrefix() &#123;</span><br><span class="line">		return this.rolePrefix;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * If &lt;code&gt;true&lt;/code&gt; (the default), indicates the</span><br><span class="line">	 * &#123;@link #getUsersByUsernameQuery()&#125; returns a username in response to a query. If</span><br><span class="line">	 * &lt;code&gt;false&lt;/code&gt;, indicates that a primary key is used instead. If set to</span><br><span class="line">	 * &lt;code&gt;true&lt;/code&gt;, the class will use the database-derived username in the returned</span><br><span class="line">	 * &lt;code&gt;UserDetails&lt;/code&gt;. If &lt;code&gt;false&lt;/code&gt;, the class will use the</span><br><span class="line">	 * &#123;@link #loadUserByUsername(String)&#125; derived username in the returned</span><br><span class="line">	 * &lt;code&gt;UserDetails&lt;/code&gt;.</span><br><span class="line">	 *</span><br><span class="line">	 * @param usernameBasedPrimaryKey &lt;code&gt;true&lt;/code&gt; if the mapping queries return the</span><br><span class="line">	 * username &lt;code&gt;String&lt;/code&gt;, or &lt;code&gt;false&lt;/code&gt; if the mapping returns a</span><br><span class="line">	 * database primary key.</span><br><span class="line">	 */</span><br><span class="line">	public void setUsernameBasedPrimaryKey(boolean usernameBasedPrimaryKey) &#123;</span><br><span class="line">		this.usernameBasedPrimaryKey = usernameBasedPrimaryKey;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected boolean isUsernameBasedPrimaryKey() &#123;</span><br><span class="line">		return this.usernameBasedPrimaryKey;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Allows the default query string used to retrieve users based on username to be</span><br><span class="line">	 * overridden, if default table or column names need to be changed. The default query</span><br><span class="line">	 * is &#123;@link #DEF_USERS_BY_USERNAME_QUERY&#125;; when modifying this query, ensure that all</span><br><span class="line">	 * returned columns are mapped back to the same column names as in the default query.</span><br><span class="line">	 * If the &apos;enabled&apos; column does not exist in the source database, a permanent true</span><br><span class="line">	 * value for this column may be returned by using a query similar to</span><br><span class="line">	 *</span><br><span class="line">	 * &lt;pre&gt;</span><br><span class="line">	 * &amp;quot;select username,password,&apos;true&apos; as enabled from users where username = ?&amp;quot;</span><br><span class="line">	 * &lt;/pre&gt;</span><br><span class="line">	 *</span><br><span class="line">	 * @param usersByUsernameQueryString The query string to set</span><br><span class="line">	 */</span><br><span class="line">	public void setUsersByUsernameQuery(String usersByUsernameQueryString) &#123;</span><br><span class="line">		this.usersByUsernameQuery = usersByUsernameQueryString;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected boolean getEnableAuthorities() &#123;</span><br><span class="line">		return this.enableAuthorities;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Enables loading of authorities (roles) from the authorities table. Defaults to true</span><br><span class="line">	 */</span><br><span class="line">	public void setEnableAuthorities(boolean enableAuthorities) &#123;</span><br><span class="line">		this.enableAuthorities = enableAuthorities;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected boolean getEnableGroups() &#123;</span><br><span class="line">		return this.enableGroups;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * Enables support for group authorities. Defaults to false</span><br><span class="line">	 * @param enableGroups</span><br><span class="line">	 */</span><br><span class="line">	public void setEnableGroups(boolean enableGroups) &#123;</span><br><span class="line">		this.enableGroups = enableGroups;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void setMessageSource(MessageSource messageSource) &#123;</span><br><span class="line">		Assert.notNull(messageSource, &quot;messageSource cannot be null&quot;);</span><br><span class="line">		this.messages = new MessageSourceAccessor(messageSource);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GrantedAuthority"><a href="#GrantedAuthority" class="headerlink" title="GrantedAuthority"></a>GrantedAuthority</h2><p>Authentication的另一个重要方法是 getAuthorities()，获取 该用户有哪些 权限。</p>
<h2 id="AuthenticationManager"><a href="#AuthenticationManager" class="headerlink" title="AuthenticationManager"></a>AuthenticationManager</h2><p>AuthenticationManager 也是一个接口, 就是 验证 登录的用户 是否 合法，如何合法，则返回一个 authentication， 不合法直接 抛错。</p>
<h2 id="ProviderManager"><a href="#ProviderManager" class="headerlink" title="ProviderManager"></a>ProviderManager</h2><p>ProviderManager是 实现AuthenticationManager接口的类。表面上是这样。<br>实际上，ProviderManager 将这个认证的 工作 委托给 一列 AuthenticationProvider。 又AuthenticationProvider 来 验证用户。</p>
<h2 id="AuthenticationProvider"><a href="#AuthenticationProvider" class="headerlink" title="AuthenticationProvider"></a>AuthenticationProvider</h2><p>AuthenticationProvider也是接口。 如何验证用户呢？ 还记得上面的UserDetails吗？</p>
<h2 id="DaoAuthenticationProvider"><a href="#DaoAuthenticationProvider" class="headerlink" title="DaoAuthenticationProvider"></a>DaoAuthenticationProvider</h2><p>DaoAuthenticationProvider实现了AuthenticationProvider接口，通常 ，使用 DaoAuthenticationProvider 来实现验证用户的。 因为用户名密码 通常存在数据库中。</p>
<p>使用DaoAuthenticationProvider需要两个信息，</p>
<ul>
<li>userDetailsService</li>
<li>passwordEncoder   加密方式</li>
</ul>
<p><a href="https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/reference/htmlsingle/#core-services-dao-provider" target="_blank" rel="noopener">DaoAuthenticationProvider</a></p>
<h2 id="UserDetailsService实现"><a href="#UserDetailsService实现" class="headerlink" title="UserDetailsService实现"></a>UserDetailsService实现</h2><p>有一种 In-Memory 内存中存储 用户信息的方法 ，但这种 只可以调试 ，是无法在 生产中使用的。</p>
<p>实际中使用的 ，用户名 和 密码一般是在 数据库中存储的。<br>上面已经贴了一个 JdbcDaoImpl.java 的实现 。</p>
<p>这里了使用的是原生的 dataSource 。 但如果 代码中使用了 如 Mybatis这样的 dao ，只需要小小改动一下 ，自己实现一下 loadUserByUsername 这个方法即可。</p>
<p>实现loadUserByUsername 的过程 ，也即是 实现 UserDetails的过程。</p>
<p>实现UserDetails的 Domain 一般是 存在 数据库中的 记录对应的 pojo。</p>
<h2 id="Password-Encoding"><a href="#Password-Encoding" class="headerlink" title="Password Encoding"></a>Password Encoding</h2><p>推荐使用 BCryptPasswordEncoder 来作为 加密器。<br>BCryptPasswordEncoder的特点就 加密特别慢， 这样 破解起来就很慢了 。</p>
</div></article></div><div id="disqus_thread"></div></div><div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;"><img src="/images/WechatIMG5.jpeg" width="180px"></div><div id="ads"></div><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- 底部01--><ins style="display:block" data-ad-client="ca-pub-7674654031652018" data-ad-slot="3127803056" data-ad-format="auto" class="adsbygoogle"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});

</script><div id="SOHUCS"></div><script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js"></script><script type="text/javascript">window.changyan.api.config({
appid: 'cytkri3BC',
conf: 'prod_1e787a373da7a5fa9ef7156a6dae5e6b'
});
</script></main><footer class="footer-container"><div class="paginator"><a href="/2017/12/12/swift-tour/" class="prev">PREV</a><a href="/2017/12/11/过秦论/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2018 <a href="mailto:fupeng_2005@126.com">kunpengku</a>, <a href="http://www.miitbeian.gov.cn">京ICP备17058936号-1</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"angrypowman",'auto');ga('send','pageview');</script></body></html>